# AI Road Pothole Detector (Flask + YOLO ONNX)

Web app to **detect potholes in road images/videos** using a YOLO model (ONNX), show the **location on an embedded map**, and generate a ready-to-send **complaint/report** (Email / WhatsApp / GHMC workflow).

## Features

- **Upload images/videos** (multiple files at once)
- **Camera capture** (works on HTTPS / localhost per browser security rules)
- **Video support**: samples frames and detects potholes
- **Annotated results** saved to `static/results/`
- **Location + address**: browser GPS → reverse geocode (Nominatim via `geopy`)
- **History** stored in browser `localStorage`
- **Report generation** + optional **GHMC payload** save for automation

## Tech stack

- **Backend**: Python + Flask
- **AI inference**: Ultralytics YOLO loading an **ONNX** model (`pothole_guard.onnx`) via `onnxruntime`
- **Computer vision**: OpenCV (`opencv-python`)
- **Geocoding**: `geopy` (Nominatim / OpenStreetMap)
- **Frontend**: HTML + CSS + Vanilla JS (Geolocation API, getUserMedia, MediaRecorder)
- **Maps**: Google Maps embed (iframe)

## Project structure

```
.
├─ app.py
├─ pothole_guard.onnx                # required (place next to app.py)
├─ templates/
│  ├─ index.html
│  ├─ result.html
│  ├─ last_result.html
│  ├─ history.html
│  └─ complaint.html
├─ static/
│  ├─ style.css
│  └─ results/                       # annotated outputs (auto-created)
├─ uploads/                          # raw uploads (auto-created)
├─ scripts/
│  ├─ ghmc_submit.py                  # optional automation helper
│  └─ README_GHMC.md
└─ ghmc_payload.json                  # generated by /prepare_ghmc
```

## Requirements

- **Python 3.9+** (recommended 3.10/3.11)
- Windows / macOS / Linux
- A browser (Chrome / Edge recommended)
- The model file: **`pothole_guard.onnx`** in the project root (same folder as `app.py`)

## Setup (Windows PowerShell)

```powershell
cd "C:\Users\sksra\Desktop\pothole_web_app"

python -m venv .venv
.\.venv\Scripts\Activate.ps1

pip install flask ultralytics geopy opencv-python onnxruntime
```

## Run

```powershell
python app.py
```

Open the URL printed in the terminal (default): `http://127.0.0.1:8000`

## Usage

1. Open the home page.
2. Either:
   - **Upload files** (images/videos) → Submit → Detect, or
   - Use the **camera** (HTTPS/localhost only) → Capture/Record → Detect
3. View pothole count, location, and annotated result images.
4. Click **Generate Report** to open the Official Report page and share via Email/WhatsApp.

## Notes (camera + HTTPS)

Browsers only allow camera access on **HTTPS** (or `localhost` / `127.0.0.1`).

- On normal `http://<LAN-IP>:8000` the camera may be blocked on mobile.
- File upload works on HTTP as a fallback.

## GHMC “1‑click” workflow (optional)

From the Official Report page:

- Clicking **Lodge on GHMC (1‑click)** saves `ghmc_payload.json` on the server via `POST /prepare_ghmc`
- Then you can run the automation helper locally:

```powershell
python scripts\ghmc_submit.py
```

See `scripts/README_GHMC.md` for details.

## Troubleshooting

- **Model not found**: ensure `pothole_guard.onnx` exists next to `app.py`
- **ONNX / runtime errors**: install `onnxruntime` and keep Python 64-bit
- **Geocoding fails**: app falls back to showing `lat, lon` as address (network/timeouts can affect Nominatim)
- **Upload errors**: check terminal traceback from Flask (`python app.py`)

## License

Add your preferred license (MIT/Apache-2.0/etc.).

